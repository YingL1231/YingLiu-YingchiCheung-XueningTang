
---
title: "source data"
author: "Ying Liu, Yingchi Cheung, Xuening Tang"
date: '`r Sys.Date()`'
output: html_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r, setup}

getwd()
library(tidyverse)
library(dplyr)
library(cowplot)
library(lubridate)

mytheme <- theme_classic(base_size = 10) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "bottom")
theme_set(mytheme)
```


```{r, read data}

population<-read.csv("./data/Population_new.csv",stringsAsFactors = TRUE)

water.withdraw<-read.csv("./data/EDA final data_water.csv",stringsAsFactors = TRUE)

water.discharge<-read.csv(
  "./data/EDA_final project_wastewater_discharge.csv",stringsAsFactors = TRUE)
```

```{r, data wrangling}
#1.First step eliminate the extra column in data set and convert it into format we need.
durh_pop <- 
  population %>%
  filter(Year==2012|Year==2013|Year==2014|Year==2015
         |Year==2016|Year==2017|Year==2018|Year==2019
         |Year==2020|Year==2021)

#2.Next join the tables together as our main data frame to conduct analysis.
water_final <- left_join(water.discharge, water.withdraw, by = c("Year", "Month"))

pop_water_final <- left_join(durh_pop,water_final)
pop_water_final$Population <-as.numeric(pop_water_final$Population)

pop_water_summaries <- 
  pop_water_final %>%
  group_by(Year, Population) %>%
  summarise(mean.discharge = mean(Monthly.Discharge.Wastewater), 
            sd.discharge = sd(Monthly.Discharge.Wastewater), 
            mean.withdraw = mean(Monthly.Water.Withdraw), 
            sd.withdraw = sd(Monthly.Water.Withdraw))
#sub-data frame to draw boxplots

```

```{r, saving data}
write.csv(pop_water_final, row.names = FALSE, file = "./data/Durham_water&population_2012-2021.csv")
write.csv(pop_water_summaries, row.names = FALSE, file = "./data/Durham_county_water_withdraw&diacharge_summary.csv")
```

```{r, line charts}
discharge_linechart <- 
  ggplot(pop_water_summaries, aes(x = Year, y = mean.discharge)) +
  geom_line() +
  labs(title="Mean Wastewater Discharge From 2012-2021", y = "Mean Discharge (MGD)", x = "Year") +
  geom_smooth(method = lm)
plot(discharge_linechart)

withdraw_linechart <- 
  ggplot(pop_water_summaries, aes(x = Year, y = mean.withdraw)) +
  geom_line() +
  labs(title="Mean Water Withdraw From 2012-2021", y = "Mean Withdraw (MGD)", x = "Year") +
  geom_smooth(method = lm, color = "red")
plot(withdraw_linechart)

plot_grid(discharge_linechart, withdraw_linechart, ncol = 1, align = "v", axis = 'l')
```



```{r, boxplots}
#reshape the dataframe to draw boxplot
install.packages(MASS)
install.packages(reshape)
install.packages(reshape2)
library(MASS) 
library(reshape2) 
library(reshape)

discharge_withdraw_grouped <- melt(water_final, id = c("Year","Month"))


Wastewater_box<-
  ggplot(discharge_withdraw_grouped , aes(x = Month, y = value,group=Month, fill=variable)) +
  geom_boxplot() +
  facet_wrap(~variable)+
  mytheme
    
print(Wastewater_box)
```



```{r, linear regression discharge~withdraw}
#draw scatterplot to see if a trend exsist
discharge_withdraw <- 
  ggplot(pop_water_final, aes(x =Monthly.Water.Withdraw, y = Monthly.Discharge.Wastewater)) +
  geom_point(aes(color=Year,alpha=0.5))+
  labs(title="Scatter plot of Monthly Water Withdrawal and Monthly Wastewater Discharge",x="Monthly Water Withdraw(MGD)",y="Monthly Wastewater Discharge(MGD)")+
  mytheme
print(discharge_withdraw) 

#format the lm() function
discharge_withdraw_regression <- lm(data = pop_water_final,Monthly.Water.Withdraw~Monthly.Discharge.Wastewater)
summary(discharge_withdraw)

# Add a line and standard error for the linear regression
discharge_withdraw_plot <- 
  ggplot(pop_water_final, aes(x =Monthly.Water.Withdraw, y = Monthly.Discharge.Wastewater)) +
  geom_smooth(method = "lm",color="blue") +
  geom_point(aes(color=Year,alpha=0.5))+
  labs(title="Linear Regression Between Monthly Water Withdrawal and Monthly Wastewater Discharge",x="Monthly Water Withdrawal(MGD)",y="Monthly Wastewater Discharge(MGD)")+
  mytheme
print(discharge_withdraw_plot) 
#
par(mfrow = c(2,2), mar=c(2,2,2,2))#divide screen by2*2 cell
plot(discharge_withdraw_regression)
par(mfrow = c(1,1))
```

```{r, linear regression population~withdraw}
#scatterplot of annual population and annual mean discharge
population_discharge <- 
  ggplot(pop_water_summaries, aes(x = Population, y = mean.discharge )) +
  geom_point(aes(color=Year,alpha=0.5))+
  labs(title="Scatter plot of Annual Mean Water Withdrawal and population",x="Population",y="Mean Wastewater Discharge(MGD)")+
  mytheme
print(population_discharge)

population_discharge_scatter <- 
  ggplot(pop_water_final, aes(x = Population, y = Monthly.Discharge.Wastewater )) +
  geom_point(aes(color=Year,alpha=0.5))+
  labs(title="Scatter plot of Monthly Water Withdrawal and population",x="Population",y="Monthly Wastewater Discharge(MGD)")+
  mytheme
print(population_discharge_scatter) 
#format the lm() function
population_discharge <- lm(data = pop_water_final, Population~ Monthly.Discharge.Wastewater)
summary(population_discharge)

# Add a line and standard error for the linear regression
population_discharge_regression <- 
  ggplot(pop_water_final, aes(x = Population, y = Monthly.Discharge.Wastewater )) +
  geom_smooth(method = "lm",color="blue") +
  geom_point(aes(color=Year,alpha=0.5))+
  labs(x="Population",y="Monthly Wastewater Discharge(MGD)")+
  mytheme
print(population_discharge_regression) 
```

```{r, linear regression population~discharge}
#scatterplot of annual population and annual mean withdraw
population_withdraw <- 
  ggplot(pop_water_summaries, aes(x = Population, y = mean.withdraw )) +
  geom_point(aes(color=Year,alpha=0.5))+
  labs(title="Scatter plot of Annual Mean Water Discharge and population",x="Population",y="Mean withdraw(MGD)")+
  mytheme
print(population_withdraw)

population_withdraw_scatter <- 
  ggplot(pop_water_final, aes(x = Population, y = Monthly.Water.Withdraw )) +
  geom_point(aes(color=Year,alpha=0.5))+
  labs(title="Scatter plot of Monthly Water Discharge and population",x="Population",y="Monthly Water Withdraw(MGD)")+
  mytheme
print(population_withdraw_scatter) 
#format the lm() function
population_withdraw <- lm(data = pop_water_final, Population~ Monthly.Water.Withdraw)
summary(population_withdraw)

# Add a line and standard error for the linear regression
population_withdraw_regression <- 
  ggplot(pop_water_final, aes(x = Population, y = Monthly.Water.Withdraw )) +
  geom_smooth(method = "lm",color="blue") +
  geom_point(aes(color=Year,alpha=0.5))+
  labs(x="Population",y="Monthly Water Withdraw(MGD)")+
  mytheme
print(population_withdraw_regression) 
```

```{r, Ttest}
twosampleT<- t.test(pop_water_final$Monthly.Water.Withdraw, pop_water_final$Monthly.Discharge.Wastewater)
twosampleT
```


