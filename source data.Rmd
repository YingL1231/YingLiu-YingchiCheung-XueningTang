---
title: "source data"
author: "Ying Liu, Yingchi Cheung, Xuening Tang"
date: '`r Sys.Date()`'
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r, setup}
getwd()
library(tidyverse)
library(dplyr)
library(cowplot)
library(lubridate)

mytheme <- theme_classic(base_size = 12) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "bottom")
theme_set(mytheme)
```


```{r, read data}

population<-read.csv("./data/population2011-2022.csv",stringsAsFactors = TRUE)

water.withdraw<-read.csv("./data/EDA final data_water.csv",stringsAsFactors = TRUE)

water.discharge<-read.csv(
  "./data/EDA_final project_wastewater_discharge.csv",stringsAsFactors = TRUE)
```

```{r, data wrangling}
#1.First step eliminate the extra column in data set and convert it into format we need.
durh_pop <- 
  population %>%
  filter(Year==2012|Year==2013|Year==2014|Year==2015
         |Year==2016|Year==2017|Year==2018|Year==2019
         |Year==2020|Year==2021) %>%
  mutate(Change_Percentage = Change..)%>%
  select(Year,Population,Change_Percentage) 

#2.Next join the tables together as our main data frame to conduct results.
water_final <- left_join(water.discharge, water.withdraw, by = c("Year", "Month"))

pop_water_final <- full_join(durh_pop,water_final)#main data frame to draw line charts

pop_water_summaries <- 
  pop_water_final %>%
  group_by(Year, Population) %>%
  summarise(mean.discharge = mean(Monthly.Discharge.Wastewater), 
            sd.discharge = sd(Monthly.Discharge.Wastewater), 
            mean.withdraw = mean(Monthly.Water.Withdraw), 
            sd.withdraw = sd(Monthly.Water.Withdraw))
#sub-data frame to draw boxplots

```

```{r, saving data}
write.csv(pop_water_final, row.names = FALSE, file = "./data/Durham_water&population_2012-2021.csv")
write.csv(pop_water_summaries, row.names = FALSE, file = "./data/Durham_county_water_withdraw&diacharge_summary.csv")
```

```{r, line charts}
discharge_linechart <- 
  ggplot(pop_water_summaries, aes(x = Year, y = mean.discharge)) +
  geom_line() +
  labs(title="Mean Wastewater Discharge" , subtitle = "From 2012-2021", y = "Mean Discharge (MGD)", x = "Year") +
  geom_smooth(method = lm)

withdraw_linechart <- 
  ggplot(pop_water_summaries, aes(x = Year, y = mean.withdraw)) +
  geom_line() +
  labs(title="Mean Water Withdraw", subtitle = "From 2012-2021", y = "Mean Withdraw (MGD)", x = "Year") +
  geom_smooth(method = lm, color = "red")

```
```{r, fig.height = 8, fig.width = 5}
plot_grid(discharge_linechart, withdraw_linechart, ncol = 1, align = "v", axis = 'l')

```

```{r}
DW_linechart = ggplot() +
  geom_line (data = pop_water_summaries, aes(x = Year, y = mean.discharge), color ="blue") +
  geom_line(data = pop_water_summaries, aes(x = Year, y = mean.withdraw), color = "red") +
  xlab("Year")+
  ylab("Millions of Gallons per Day")

print(DW_linechart)
```

```{r, boxplots}
Wastewater_box <-
  ggplot(water_final, aes(x = Month, y = Monthly.Discharge.Wastewater)) +
  geom_boxplot(aes(color = Year, alpha = 0.5)) +
  scale_x_discrete(drop = FALSE)
print(Wastewater_box)
```

```{r, linear regression}

```

```{r, test}

```

